{% load humanize %}

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>


<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <title>{{object.machine}}</title>
  </head>

  <div class="container">
    <body>
    <h1>Failure Report : {{object.machine}}</h1>
    
    <a class="link-opacity-10-hover" href="/maintenance/">Main page</a> |
    <a class="link-opacity-10-hover" href="/maintenance/failures/">Failures</a>
    <div class="container text-center">
        <div class="row justify-content-start">
          <div class="col-8">
            <table class="table table-bordered">
                <tbody>
                    
                    <tr>
                        <td class="bg-info col-2">Start Date</td>
                        <td>{{object.start_date}}</td>
                    </tr>
                    <tr>
                        <td class="bg-info">Expected Date</td>
                        <td>{{object.expect_date}}</td>
                    </tr>

                    <tr>
                        <td class="bg-info">End Date</td>
                        <td>{{object.end_date}}</td>
                    </tr>
                    <tr>
                        <td class="bg-info">Status</td>
                        <td>{{object.status}}</td>
                    </tr>
                    <tr>
                        <td class="bg-info">Category</td>
                        <td>{{object.category}}</td>
                    </tr>
                    <tr>
                        <td class="bg-info">Detail</td>
                        <td>{{object.details}}</td>
                    </tr>

                    <tr>
                        <td class="bg-info">Root cause</td>
                        <td>{{object.rootcause|default_if_none:"N/A"}}</td>
                    </tr>

                    <tr>
                        <td class="bg-info">Reapir action</td>
                        <td>{{object.repair_action|default_if_none:"N/A"}}</td>
                    </tr>
    
                </tbody>
            </table>
          </div>
    <!-- End Master data -->

    <p class="fs-4 text-start">รูปภาพ</p>
    <!-- Start Image -->
     <div class="row justify-content-left">
        {% for im in object.images.all %}
        <div class="col-4">
            <a href="{{im.image.url}}">
                <img src="{{im.image.url}}" alt="failures" class="img-thumbnail" width="220" height="220">
            </a>
                {{im.details}}
        </div>
        {% empty %}
            <div class="alert alert-danger" role="alert">
            ไม่มีรูปภาพประกอบ
            </div>
        {% endfor %}
     </div>
     <!-- End Image -->

     <!-- Last 10 Repair history -->
     <p class="fs-4 text-start">ประวัติอาการ 20 ครั้งล่าสุด ของ {{object.machine}}</p>
     <table class="table table-bordered">
        <thead>
        <tr class="table-primary">
            <th style="text-align:center">EQ number</th>
            <th style="text-align:center">Details</th>
            <th style="text-align:center">Start Date</th>
            <!-- <th style="text-align:center">End Date</th> -->
            <th style="text-align:center">Pictures</th>
            <th style="text-align:center">Category</th>
            <th style="text-align:center">Status</th>
        </tr>
        </thead>
        {% for obj in object.machine.failures.all|slice:":20" %}
                  <tr>
                          <td style="text-align:center"><a href="{{obj.get_absolute_url}}">{{obj.machine}}</a></td>
                          <td style="text-align:left">
                            {{obj.details}}
                            <p class="fst-italic text-primary">Root cause: {{obj.rootcause|default_if_none:"N/A"}}</p>
                          </td>
                          <td style="text-align:center">{{obj.start_date}}</td>
                          <!-- <td style="text-align:center">{{obj.end_date}}</td> -->
                          <td style="text-align:center">{{obj.image_count}}</td>
                          <td style="text-align:center">{{obj.category}}</td>
                          <td style="text-align:center">{{obj.status}}</td>
                  </tr>
        {% empty %}
                  <div class="alert alert-danger" role="alert">
                  ไม่มีข้อมูลอาการเสีย
                  </div>
        {% endfor %}
        </table>
      <!-- End Repair History -->

      <p class="fs-4 text-start">ประวัติการซ่อมบำรุง 20 ครั้งล่าสุด</p>
     <table class="table table-bordered">
        <thead>
        <tr class="table-primary">
            <th style="text-align:center">Start Date</th>
            <th style="text-align:center">End Date</th>
            <th style="text-align:center">Details</th>
            <th style="text-align:center">Period</th>
            <th style="text-align:center">Picture</th>
            <th style="text-align:center">Status</th>
        </tr>
        </thead>
        {% for object in object.machine.pms.all|slice:":20" %}
                  <tr>
                          <td style="text-align:center">{{object.start_date}}</td>
                          <td style="text-align:center">{{object.end_date}}</td>
                          <td style="text-align:left">{{object.details}}</td>
                          <td style="text-align:center">{{object.period}} {{period_unit}}</td>
                          <td style="text-align:center">{{object.image_count}}</td>
                          <td style="text-align:center">{{object.status}}</td>
                  </tr>
        {% empty %}
                  <div class="alert alert-danger" role="alert">
                  ไม่มีข้อมูลการซ่อมบำรุง
                  </div>
        {% endfor %}
        </table>



    </body>
    <hr>


    </body>
 </div>